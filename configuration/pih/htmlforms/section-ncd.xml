<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http//license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
  -->

<htmlform id="ncd-section" 
          formName="NCD section" formUuid="8bb13d24-e341-42e6-84ef-8fb73d1fce82"
          formVersion="1.0">

    <postSubmissionAction class="org.openmrs.module.pihcore.htmlformentry.action.CleanDiagnosisConstructAction"/>

    <translations defaultLocale="en">
        <code name="o2Sat">
            <variant locale="en" value="O&lt;sub&gt;2&lt;/sub&gt; Sat"/>
            <variant locale="fr" value="SpO&lt;sub&gt;2&lt;/sub&gt;"/>
            <variant locale="es" value="SatO&lt;sub&gt;2&lt;/sub&gt;"/>
        </code>
    </translations>

    <style type="text/css">

        .narrow {
            width: 200px;
        }

        .field-error {
            color: #ff6666;
            font-size: 1.1em;
            display: block;
        }

        form fieldset {
            min-width: 90%;
            display: block;
        }

        .encounter-summary-container #calculated-ratio {
            font-size: 1em;
            font-weight: normal;
        }

        .half-size-text {
            color: #ff6666;
            font-size: 50%;
            display: block;
        }

        .section-container {
            background: #F2F2F2;
            box-shadow: 3px 3px 3px 1px rgba(0, 0, 0, 0.2);
            padding: 10px 5px 10px 15px;
            line-height: 1.5em; /*add this for vertical spacing between elements*/
        }

        .section-container input[type="checkbox"] {
            margin: 0px 5px; /*changed values to vertical, horizontal*/
            top:5px; /*added to offset the checkbox position to line up*/
        }

        .section-container label { /*new definition to override labels inside section-containers*/
            margin: 0px;
        }

        - .section {
            width: 100%;
        }

        textarea {
            width: 95%;
        }

        ul.copd {
            list-style-position: outside;
        }

        .five-columns, .four-columns, .three-columns, .two-columns {
            display: table;
            height: 100%;
            width: 100%;
        }

        .two-columns > div {
            display: table-cell;
            width: 50%;
        }

        .three-columns > div {
            display: table-cell;
            width: 33%;
        }

        .four-columns > div {
            display: table-cell;
            width: 25%;
        }

        .five-columns > div {
            display: table-cell;
            width: 20%;
        }

        .side-by-side label {
            display: inline-block;
        }

        .list-inline label, .list-inline input[type="radio"], .list-inline span,
        .list-inline-wide label, .list-inline-wide input[type="radio"], .list-inline-wide span,
        .list-inline-extra-wide label, .list-inline-extra-wide input[type="radio"], .list-inline-extra-wide span {
            display: inline-block;
            float: none;
        }

        .list-inline label:first-child {
            width: 220px;
        }

        .list-inline-wide label:first-child {
            width: 320px;
        }

        .list-inline-extra-wide label:first-child {
            width: 420px;
        }

        label {
            padding: 0px 3px 0px 0px
        }

        form input[type="radio"], .form input[type="radio"] {
            float: none;
            display: inline-block;
        }
    </style>

    <ifMode mode="VIEW" include="false">
        <script type="text/javascript">
            jq(function() {

                jq('.symptom-checkbox > input:checkbox').each(function(idx, it){
                    if(jq(it).not(':checked')){
                        jq(it).closest("td").siblings().find(":input").each(function(i, el){
                            jq(el).attr("disabled", "disabled");
                        });
                    }

                    jq(it).change(function(){
                        if(jq(this).is(':checked')){
                            jq(this).closest("td").siblings().find(":input").each(function(i, el){
                                jq(el).removeAttr("disabled");
                            });
                        } else {
                            jq(this).closest("td").siblings().find(":input").each(function(i, el){
                                jq(el).val('').attr("disabled", "disabled");
                            });
                        }
                    });
                });

                // handlers for next and submit buttons, see nextAndSubmitButtons.js
                setUpNextAndSubmitButtons();

            });
        </script>
    </ifMode>

    <section id="ncd_info" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.ncd.category">
        <div class="section-container">

            <!-- Program enrollment -->
            <enrollInProgram programId="NCD" locationTag="Program Location" />

            <label>
                <uimessage code="pihcore.ncd.category.instructions"/>
            </label>

            <repeat>
                <template>
                    <obs conceptId="PIH:NCD category" answerConceptId="{category}" answerCode="{code}"
                         toggle="{nickname}" style="checkbox"/>
                </template>

                <render category="PIH:DIABETES" nickname="diabetes" code="Diabetes"/>
                <render category="PIH:HYPERTENSION" nickname="htn" code="Hypertension"/>
                <render category="PIH:HEART FAILURE" nickname="heart_failure" code="Heart failure"/>
                <render category="PIH:Chronic respiratory disease program" nickname="respire" code="Chronic lung disease" />
                <render category="CIEL:145438" nickname="kidney_failure" code="Chronic kidney disease"/>
                <render category="PIH:3714" nickname="cirrhosis" code="Liver cirrhosis / Hepatitis B" />
                <render category="CIEL:160849" nickname="palliative" code="Palliative care"/>
                <render category="PIH:Sickle-Cell Anemia" nickname="sickle" code="Sickle cell"/>
                <render category="CIEL:5622" nickname="other-ncd" code="Other"/>
            </repeat>
        </div>
    </section>

    <!-- Only show vitals for intake; For followup, vitals are shown in the visit information (section-ncd-followup.xml) -->
    <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">

        <script type="text/javascript">

            jq(document).ready(function() {

                const vitalsSignsEncounterType = '4fb47712-34a6-40d2-8ed3-e153abbd25b7';
                const weightConceptUuid = '3ce93b62-26fe-102b-80cb-0017a47871b2';
                const heightConceptUuid = '3ce93cf2-26fe-102b-80cb-0017a47871b2';
                const systolicBPConceptUuid = '3ce934fa-26fe-102b-80cb-0017a47871b2';
                const diastolicBPConceptUuid = '3ce93694-26fe-102b-80cb-0017a47871b2';
                const hrConceptUuid = '3ce93824-26fe-102b-80cb-0017a47871b2';
                const temperatureConceptUuid = '3ce939d2-26fe-102b-80cb-0017a47871b2';
                const muacConceptUuid = 'e3e03a93-de7f-41ea-b8f2-60b220b970e9';
                const respiratoryRateConceptUuid = '3ceb11f8-26fe-102b-80cb-0017a47871b2';
                const o2SatConceptUuid = '3ce9401c-26fe-102b-80cb-0017a47871b2';

                const contextPath = window.location.href.split('/')[3];
                const apiBaseUrl =  "/" + contextPath + "/ws/rest/v1";
                const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
                const monthOption = { month: 'short'};

                const patientUuid = '<lookup expression="patient.uuid"/>';
                let currentEncounterDate = new Date();
                let lookupEncDate = '<lookup expression="encounter.getEncounterDatetime().getTime()"/>';
                if ( lookupEncDate ) {
                    currentEncounterDate = new Date(+lookupEncDate);
                }

                let serverEncounterDate = '<lookup complexExpression="#if ($encounter) #set ($encounterDate = $encounter.encounterDatetime) #else #set ($encounterDate = $visit.startDatetime) #end"/>';

                const visitUuid = '<lookup expression="encounter.getVisit().getUuid()"/>';

                jq.getJSON(apiBaseUrl + "/visit/" + visitUuid, {
                    v: 'custom:(uuid,id,startDatetime,encounters:(uuid,display,encounterDatetime,encounterType:(uuid,name),obs:(uuid,display,concept:(uuid,display),obsDatetime,value)))'
                },
                function( data ){
                    if (data.encounters &amp;&amp; data.encounters.length &gt; 0) {
                        for (let index=0; index &lt; data.encounters.length; ++index) {
                        let encounter = data.encounters[index];
                        if (encounter.encounterType.uuid === vitalsSignsEncounterType) {
                            // we found a VitalsSigns encounter on this visit
                            let encounterDate = new Date(encounter.encounterDatetime);
                            let month = new Intl.DateTimeFormat(undefined, monthOption).format(encounterDate);
                            jq("#lastVitalsEncounterDate").text(encounterDate.getDate() + "-" + month + "-" + encounterDate.getFullYear());
                            jq("#lastVitalsEncounterTime").text(encounterDate.toLocaleTimeString());

                            let last_weight = null;
                            let last_height = null;
                            let last_bmi = null;
                            if (encounter.obs &amp;&amp; encounter.obs.length &gt; 0) {
                                jq('#lastVitals').show();
                                for (let j=0; j &lt; encounter.obs.length; ++j) {
                                    let obs = encounter.obs[j];
                                    if (obs.concept.uuid === systolicBPConceptUuid) {
                                        jq("#last_bp_systolic").text(obs.value);
                                        jq("#last_bp_systolic").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === diastolicBPConceptUuid) {
                                        jq("#last_bp_diastolic").text(obs.value);
                                        jq("#last_bp_diastolic").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === hrConceptUuid) {
                                        jq("#last_heart_rate").text(obs.value);
                                        jq("#last_heart_rate").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === temperatureConceptUuid) {
                                        jq("#last_temperature_c").text(obs.value);
                                        jq("#last_temperature_c").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === muacConceptUuid) {
                                        jq("#last_muac_mm").text(obs.value);
                                        jq("#last_muac_mm").removeClass("emptyValue").addClass("value");
                                    }  else if (obs.concept.uuid === respiratoryRateConceptUuid) {
                                        jq("#last_respiratory_rate").text(obs.value);
                                        jq("#last_respiratory_rate").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === o2SatConceptUuid) {
                                        jq("#last_o2_sat").text(obs.value);
                                        jq("#last_o2_sat").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === weightConceptUuid) {
                                        jq("#last_weight").text(obs.value);
                                        last_weight = obs.value;
                                        jq("#last_weight").removeClass("emptyValue").addClass("value");
                                    } else if (obs.concept.uuid === heightConceptUuid) {
                                        jq("#last_height").text(obs.value);
                                        last_height = obs.value;
                                        jq("#last_height").removeClass("emptyValue").addClass("value");
                                    }
                                }

                                if (last_weight &amp;&amp; last_height) {
                                    last_bmi = last_weight / ((last_height/100) * (last_height/100));
                                    jq("#last_bmi").text(last_bmi.toFixed(1));
                                    jq("#last_bmi").removeClass("emptyValue").addClass("value");
                                }
                                break;
                            }
                        }
                    }
                }
                });
            });
        </script>

         <section id="vitals" sectionTag="fieldset" headerTag="legend" headerStyle="title"
                 headerCode="pihcore.vitalSigns">
            <div class="section-container">

                <!-- Previous vitals from the same encounter -->
                <div id="lastVitals" class="hidden section-container">
                    <table style="color:grey">
                        <tr>
                            <td>
                                <label>
                                    <uimessage code="mirebalais.mostRecentVitals.label"/>
                                    <span class="date-span ng-binding">
                                        <i class="icon-calendar"></i>
                                        <span id="lastVitalsEncounterDate"></span>
                                    </span>
                                    <span class="time-span ng-binding">
                                        <i class="icon-time"></i>
                                        <span id="lastVitalsEncounterTime"></span>
                                    </span>
                                </label>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div class="five-columns">
                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.bloodPressure.title"/>&amp;nbsp;
                                        </label>
                                        <span class="small">
                                            <span id="last_bp_systolic" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">/</span>
                                            <span id="last_bp_diastolic" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">mm/Hg</span>
                                        </span>
                                    </div>

                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.respiratoryRate.title"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_respiratory_rate" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">/min</span>
                                        </span>
                                    </div>

                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.weight.title"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_weight" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">kg</span>
                                        </span>
                                    </div>

                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.height.title"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_height" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">cm</span>
                                        </span>
                                    </div>

                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.bmi.title"/>
                                        </label>
                                        <!-- TodDo:  Add calculated BMI -->
                                        <span class="small">
                                            <span id="last_bmi" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div class="five-columns">
                                    <div></div>
                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.heartRate.title"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_heart_rate" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">/min</span>
                                        </span>
                                    </div>

                                    <div>
                                        <label>
                                            <uimessage code="o2Sat"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_o2_sat" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">%</span>
                                        </span>
                                    </div>

                                    <div>
                                        <label>
                                            <uimessage code="mirebalais.vitals.temperature.title"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_temperature_c" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value">°C</span>
                                        </span>
                                    </div>
                                    <div>
                                        <!-- only show MUAC if patient is less than 13 years old (on the encounterDate)-->
                                        <includeIf velocityTest="(13 > $patient.getAge($encounter.getEncounterDatetime()))">
                                        <label>
                                            <uimessage code="mirebalais.vitals.muac.navigation.title"/>
                                        </label>
                                        <span class="small">
                                            <span id="last_muac_mm" class="obs-field">
                                                <span class="emptyValue">____</span>
                                            </span>
                                            <span class="append-to-value"><uimessage code="emr.units.millimeters"/></span>
                                        </span>
                                        </includeIf>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <br/>

                <div class="three-columns">
                    <div>
                        <label>
                            <uimessage code="mirebalais.vitals.bloodPressure.short.title"/>
                        </label>
                        <span class="small">
                            <ifMode mode="VIEW" include="true">
                                <span class="append-to-value">
                                    <obs conceptId="CIEL:5085" id="bp_systolic"/>
                                </span>
                                <span class="append-to-value">/</span>
                                <span class="append-to-value">
                                    <obs conceptId="CIEL:5086" id="bp_diastolic"/>
                                </span>
                                <span class="append-to-value">mm/Hg</span>
                            </ifMode>
                            <ifMode mode="VIEW" include="false">
                                <span class="append-to-value left">
                                    <obs conceptId="CIEL:5085" id="bp_systolic"/>
                                </span>
                                <span class="append-to-value left">/</span>
                                <span class="append-to-value left">
                                    <obs conceptId="CIEL:5086" id="bp_diastolic"/>
                                </span>
                                <span class="append-to-value">mm/Hg</span>
                            </ifMode>
                        </span>
                    </div>
                    <div>
                        <p class="side-by-side">
                            <label>
                                <uimessage code="Glucose fingerstick" />
                            </label>
                            <br/>
                            <obs conceptId="PIH:6689" style="radio"
                                 answerConceptIds="CIEL:1065,CIEL:1066"
                                 answerCodes="FBG,RBG" answerSeparator="&lt;br /&gt;" />
                        </p>

                        <!-- only show MUAC if patient is less than 13 years old (on the encounterDate)-->
                        <includeIf velocityTest="(13 > $patient.getAge($encounter.getEncounterDatetime()))">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="MUAC"/>
                                </label>
                                <br/>
                                <obs id="muac-results" conceptId="CIEL:160908" style="radio"
                                     answerConceptIds="CIEL:127778,CIEL:160910,CIEL:160909"
                                     answerCodes="red,yellow,green"
                                     answerSeparator="&lt;br /&gt;"/>
                            </p>
                        </includeIf>
                    </div>
                    <div>
                        <p class="side-by-side">
                            <label>
                                <uimessage code="BMI results"/>
                            </label>
                            <br/>
                            <obs id="bmi-results" conceptId="CIEL:167092" style="radio"
                                 answerConceptIds="CIEL:167090,CIEL:114413,CIEL:115115,CIEL:133952"
                                 answerCodes="Normal (BMI 18.5 - 24.9),Overweight (BMI 25.0 - 29.9),Moderate obese (BMI 30.0 - 34.9),Severe obese (BMI 35.0 - 39.9)"
                                 answerSeparator="&lt;br /&gt;"/>

                            <br/><br/>
                            <obsgroup groupingConceptId="PIH:1292" showIfEmpty="false">
                                <obs style="radio"
                                     conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT"
                                     conceptLabels="yes,no" answerConceptId="CIEL:115115" labelText="Obesity"/>
                            </obsgroup>
                        </p>

                    </div>
                </div>

            </div>
        </section>

    </includeIf>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.visitNote.clinicalNotes">
        <div class="section-container">
            <obs conceptId="CIEL:161011" style="textarea" />
        </div>
    </section>

    <section id="hospital" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="Hospitalization">
        <div class="section-container">
            <obsgroup groupingConceptId="PIH:HOSPITALIZATION CONSTRUCT" showIfEmpty="false">

                <p class="side-by-side">
                    <label>
                        <uimessage code="Hospitalization since last visit"/>
                    </label>
                    <obs id="hospital-stay" conceptId="CIEL:976" style="radio"
                         answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1067">
                        <controls>
                            <when value="CIEL:1065" thenDisplay="#hospital-details"/>
                        </controls>
                    </obs>
                </p>

                <div id="hospital-details" class="two-columns">
                    <div>
                        <p class="side-by-side">
                            <label>
                                <uimessage code="Number of hospitalizations since last visit"/>
                            </label>
                            <obs conceptId="CIEL:1773" />
                            <br/>

                            <label>
                                <uimessage code="Number of days"/>
                            </label>
                            <obs conceptId="PIH:2872" showUnits="coreapps.days" unitsCssClass="append-to-value" />
                            <br/><br/>

                        </p>

                        <p>
                            <label>
                                <uimessage code="NCD diagnosis which caused hospitalization" />
                            </label>
                            <repeat>
                                <template>
                                    <obs id="{nickname}-q" conceptId="PIH:12476" style="checkbox"
                                         answerConceptId="{answId}" answerCode="{name}" >
                                        <controls>
                                            <when value="CIEL:119481" thenDisplay="#{nickname}-plus" />
                                            <when value="CIEL:139069" thenDisplay="#{nickname}-plus" />
                                            <when value="CIEL:155569" thenDisplay="#{nickname}-plus" />
                                            <when value="CIEL:145438" thenDisplay="#{nickname}-plus" />
                                            <when value="CIEL:117703" thenDisplay="#{nickname}-plus" />
                                            <when value="PIH:3714"    thenDisplay="#{nickname}-plus" />
                                            <when value="CIEL:117598" thenDisplay="#{nickname}-plus" />
                                        </controls>
                                    </obs>
                                </template>
                                <render answId="CIEL:119481" nickname="dm" name="Diabetes mellitus (DM)"/>
                                <render answId="CIEL:117399" nickname="htn" name="Hypertension"/>
                                <render answId="CIEL:139069" nickname="hf" name="Heart failure"/>
                                <render answId="CIEL:155569" nickname="respire" name="Chronic lung disease" />
                                <render answId="CIEL:145438" nickname="ckd" name="Chronic kidney disease"/>
                                <!-- <render answId="PIH:3714" nickname="liver" name="Liver cirrhosis" /> -->
                                <render answId="CIEL:117598" nickname="liver" name="Liver decompensation" />
                                <render answId="CIEL:117703" nickname="sickle" name="Sickle cell disease" />
                                <render answId="CIEL:160849" nickname="palliative" name="Palliative care"/>
                            </repeat>
                        </p>

                        <!-- this section is ONLY included for NCD intake encounter -->
                        <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                            <p>
                                <label>
                                    <uimessage code="Other diagnoses during hospitalization"/>
                                </label>
                                <obs conceptId="PIH:6899" style="textarea" rows="3"/>
                            </p>

                        </includeIf>
                    </div>

                    <div>
                        <p class="side-by-side">
                            <label>
                                <uimessage code="mirebalais.dischargeNote.dischargeDate.label"/>
                            </label>
                            <obs conceptId="CIEL:1641" allowTime="false" />
                            <br/>

                        </p>

                        <!-- this section is ONLY included for NCD intake encounter -->
                        <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                            <p>
                                <label>
                                    <uimessage code="Treatment at discharge" />
                                </label>

                                <repeat>
                                    <template>
                                        <obs conceptId="PIH:14468" style="checkbox"
                                             answerConceptId="{answId}" answerCode="{name}" />
                                    </template>
                                    <render answId="CIEL:78056" name="Insulin"/>
                                    <render answId="CIEL:167915" name="Oral anti-diabetic"/>

                                    <render answId="PIH:14775" name="Short acting morphine"/>
                                    <render answId="PIH:14776" name="Long acting morphine"/>
                                </repeat>

                                <obs conceptId="PIH:14715" labelCode="Other treatment at discharge" />
                            </p>

                            <div id="dm-plus">
                                <p>
                                    <label>
                                        <uimessage code="DM diagnosis on discharge"/>
                                    </label>
                                    <repeat>
                                        <template>
                                            <obs conceptId="PIH:14921" answerConceptId="{diagId}" style="checkbox"/>
                                        </template>
                                        <render diagId="CIEL:142460" diagName="Diabetes with hyperosmolar coma" />
                                        <render diagId="CIEL:142452" diagName="Diabetic foot" />
                                        <render diagId="CIEL:142454" diagName="DKA with coma" />
                                        <render diagId="CIEL:122714" diagName="DKA without coma" />
                                        <render diagId="PIH:14832"   diagName="Hyperglycemia without complications" />
                                    </repeat>
                                </p>
                            </div>

                            <div id="hf-plus">
                                <p>
                                    <obs conceptId="CIEL:1651" style="checkbox"
                                         answerConceptId="CIEL:159567"
                                         answerCode="Echocardiogram performed"/>
                                </p>
                            </div>

                            <div id="respire-plus">
                                <p class="side-by-side">
                                    <label>
                                        <uimessage code="Chronic lung disease screening tool during hospitalization" />
                                    </label>
                                    <br/>
                                    <obs conceptId="PIH:14602" style="radio"
                                         answerConceptIds="CIEL:703,CIEL:664,CIEL:1118" />
                                </p>
                            </div>

                            <div id="ckd-plus">
                                <p>
                                    <label>
                                        <uimessage code="Creatinine at discharge" />
                                    </label>
                                    <obs conceptId="CIEL:790" showUnits="true" />
                                </p>
                            </div>

                            <div id="liver-plus">
                                <p>
                                    <label>
                                        <uimessage code="Liver diagnosis on discharge"/>
                                    </label>
                                    <repeat>
                                        <template>
                                            <obs conceptId="PIH:14921" answerConceptId="{diagId}" style="checkbox"/>
                                        </template>
                                        <render diagId="CIEL:113808" diagName="Spontaneous bacterial peritonitis" />
                                        <render diagId="CIEL:148346" diagName="Ascites" />
                                        <render diagId="CIEL:138834" diagName="Liver encephalopathy" />
                                        <render diagId="CIEL:136443" diagName="Jaundice" />
                                        <render diagId="CIEL:139582" diagName="Gastrointestinal bleeding" />
                                    </repeat>
                                </p>
                            </div>

                            <div id="sickle-plus">
                                <p>
                                    <label>
                                        <uimessage code="Main complications with sickle cell"/>
                                    </label>
                                    <repeat>
                                        <template>
                                            <obs conceptId="PIH:14839" style="checkbox" 
                                                 answerConceptId="{diagId}" answerCode="{sickleComplic}"/>
                                        </template>
                                        <render diagId="CIEL:121629" sickleComplic="Anemia" />
                                        <render diagId="CIEL:165590" sickleComplic="Pain crisis" />
                                        <render diagId="CIEL:124842" sickleComplic="Thoracic outlet syndrome" />
                                        <render diagId="CIEL:121262" sickleComplic="Bacterial infection" />
                                        <render diagId="CIEL:116128" sickleComplic="Malaria" />
                                        <render diagId="CIEL:111103" sickleComplic="Stroke" />
                                        <render diagId="CIEL:1063"   sickleComplic="Blood transfusion" />
                                    </repeat>
                                </p>
                            </div>

                            <p>
                                <label>
                                    <uimessage code="Other diagnoses at discharge"/>
                                </label>
                                <obs conceptId="PIH:14922" />
                            </p>

                        </includeIf>
                    </div>
                </div>
            </obsgroup>

        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.ncd.diabetes">
        <div id="diabetes" class="section-container">

            <!-- this section is ONLY included for NCD intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <table>
                    <tr>
                        <th>
                            <label>
                                <uimessage code="pihcore.ncd.diabetesType"/>
                            </label>
                        </th>
                        <th>
                            <label>
                                <uimessage code="pihcore.suggestedTreatment.label"/>
                            </label>
                        </th>
                    </tr>

                    <!-- Diabetes diagnoses for females and males -->
                    <includeIf velocityTest="$patient.gender == 'F' ">
                        <tr>
                            <td>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <p class="side-by-side">
                                        <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                             answerConceptIds="CIEL:142474,CIEL:142473,PIH:Gestational diabetes,CIEL:119481"
                                             answerCodes="Type 1 DM,Type 2 DM,Gestational DM,DM not yet specified"
                                             answerSeparator="&lt;br /&gt;"/>
                                    </p>
                                </obsgroup>
                            </td>
                            <td align="top">
                                <repeat with="['type1Dm','CIEL:142474','Type 1'],
                                      ['type2Dm','CIEL:165208','Type 2'],
                                      ['gestationalDm','PIH:Gestational diabetes','Gestational']">
                                    <uimessage code="pihcore.ncd.diabetes.{0}Treatment.full"/>
                                    <br/>
                                    <br/>
                                </repeat>
                            </td>
                        </tr>
                    </includeIf>
                    <includeIf velocityTest="$patient.gender != 'F' ">
                        <tr>
                            <td>
                                <p class="side-by-side">
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:142474,CIEL:142473,CIEL:119481"
                                         answerCodes="Type 1 DM,Type 2 DM,DM not yet specified"
                                         answerSeparator="&lt;br /&gt;"/>
                                </obsgroup>
                                </p>
                            </td>
                            <td align="top">
                                <repeat with="['type1Dm','CIEL:142474','Type 1'],
                                  ['type2Dm','CIEL:165208','Type 2']">
                                    <uimessage code="pihcore.ncd.diabetes.{0}Treatment.full"/>
                                    <br/>
                                </repeat>
                            </td>
                        </tr>
                    </includeIf>
                </table>
                <br/>
            </includeIf>

            <strong>
                <uimessage code="Complications related to diabetes"/>
            </strong>
            <div class="two-columns">
                <div>
                    <repeat>
                        <template>
                            <obs id="complications-dm" conceptId="PIH:14485" style="checkbox"
                                 answerConceptId="{acid}" answerCode="{ansLabel}"/>
                        </template>
                        <render acid="CIEL:142452" ansLabel="Diabetic foot"/>
                        <render acid="CIEL:118983" ansLabel="Neuropathy"/>
                        <render acid="CIEL:142429" ansLabel="Diabetic retinopathy"/>
                        <render acid="CIEL:119270" ansLabel="Cardiovascular disease"/>
                        <render acid="CIEL:111103" ansLabel="Stroke"/>
                        <render acid="CIEL:145438" ansLabel="CKD"/>
                        <render acid="CIEL:120860" ansLabel="Catarata"/>
                        <render acid="CIEL:150807" ansLabel="Sexual dysfunction"/>
                        <render acid="PIH:14706"   ansLabel="Injection site"/>
                        <render acid="CIEL:1107"   ansLabel="None"/>
                    </repeat>
                    <div id="other-complications-dm" >
                        <label>
                            <uimessage code="if other complications, specify"/>
                        </label>
                        <obs conceptId="PIH:14711"/>
                    </div>
                </div>
                <div id="injection-site" >
                    <label>
                        <uimessage code="Complications at injection site"/>
                    </label>
                    <repeat>
                        <template>
                            <obs conceptId="PIH:14706" style="checkbox"
                                 answerConceptId="{cid}" answerCode="{answerLabel}"/>
                        </template>
                        <render cid="PIH:14705"   answerLabel="Lipohypertrophy" />
                        <render cid="CIEL:137300" answerLabel="Infection" />
                        <render cid="CIEL:156567" answerLabel="Hematoma" />
                        <render cid="CIEL:5622"   answerLabel="Other" />
                    </repeat>
                </div>
            </div>

            <br/>

            <strong>
                <uimessage code="Diabetes followup indicators"/>
            </strong>

            <obsgroup groupingConceptId="PIH:14469" showIfEmpty="false">
                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{xId}"/>
                                    </label>
                                    <obs id="dm-fui-{tog}" conceptId="{message}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown" >
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#dm-fui-{tog}-details"/>
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render message="CIEL:1898"   xId="Patient condition improved" tog="improved"/>
                            <render message="CIEL:164075" xId="Overall treatment adherence" tog="adher"/>
                            <render message="CIEL:167819" xId="Missed doses in past week" tog="missed"/>
                            <render message="CIEL:167021" xId="Aware and understands the disease" tog="aware"/>
                            <render message="CIEL:167914" xId="Understands treatment" tog="understands"/>
                            <render message="PIH:14741"   xId="Ability to titrate diuretic" tog="titrate"/>
                        </repeat>
                    </div>
                    <div id="dm-fui-missed-details">
                        <br/><br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"  />

                    </div>
                </div>

                <ifMode mode="VIEW" include="false">
                    <table align="left" style="font-size:small">
                        <tr>
                            <th colspan="2">
                                Definition of disease control
                            </th>
                            <td>
                                HBA1c &lt; 7% (53 mmol/m)
                                <i>(if available, the best measurement)</i><br/>
                                Preprandial glucose: 80 - 130 mg/dL (4.4 - 7.2 mmol/L)<br/>
                                Postprandial glucose:  &lt; 180 mg/dL (10 mmol/L)
                            </td>
                        </tr>
                    </table>
                </ifMode>

                <p class="list-inline-wide">
                    <label>
                        <uimessage code="Disease control"/>
                    </label>
                    <obs conceptId="PIH:11506" style="radio"
                         answerConceptIds="PIH:11507,PIH:11508,PIH:11509"
                         answerCodes="controlled,uncontrolled,complications" />
                </p>

                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline-wide">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs id="dm-{q}-top" conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO"
                                         answerCodes="yes,no" >
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#dm-{q}-details" />
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render qId="PIH:6756"    questionName="On insulin" q="insulin"/>
                            <render qId="CIEL:167957" questionName="Severe hypoglycemia in last month" q="severe"/>
                            <render qId="CIEL:167956" questionName="Glycometer (home)" q="home"/>
                            <render qId="CIEL:167919" questionName="Ability to read and manage glycometer" q="abiity" />
                            <render qId="PIH:14709"   questionName="Patient adjusted insulin based on glucometer" q="adjust"/>
                            <render qId="CIEL:167998" questionName="On ACE inhibitors" q="ace"/>
                        </repeat>

                        <div id="dm-ace-details" style="margin-left: 20px">
                            <p class="list-inline-wide">
                                <label>
                                    <uimessage code="Indications on ACE inhibitors"/><br/>
                                    <uimessage code="(proteinuria present; BP &gt;= 135/75)"/>
                                </label>
                                <obs conceptId="CIEL:168000" style="radio"
                                     answerConceptIds="PIH:YES,PIH:NO"
                                     answerCodes="yes,no" />
                            </p>
                        </div>
                    </div>
                    <div>
                        <br/>
                        <label>
                            <uimessage code="# of hypoglycemic episodes in past 30 days"/>
                        </label>
                        <p class="narrow">
                            <obs conceptId="PIH:14708"/>
                        </p>
                    </div>
                </div>

            </obsgroup>

            <strong>
                <uimessage code="Fundoscopy"/>
            </strong>
            <p class="side-by-side">
                <label>
                    <uimessage code="Fundoscopy performed" />
                </label>
                <obs id="fundy-perf" conceptId="CIEL:167916" style="radio"
                     answerConceptIds="CIEL:1267,PIH:NOT DONE">
                    <controls>
                        <when value="CIEL:1267" thenDisplay="#fundy-results" />
                    </controls>
                </obs>

                <div id="fundy-results" class="two-columns">
                    <div>
                        <p class="side-by-side" style="margin-left: 30px">
                            <label>
                                <uimessage code="Fundoscopy results"/>
                            </label>
                            <obs id="fun-abnorm" conceptId="CIEL:167917" style="radio"
                                 answerConceptIds="CIEL:1115,CIEL:1116">
                                <controls>
                                    <when value="CIEL:1116" thenDisplay="#fun-findings"/>
                                </controls>
                            </obs>
                        </p>
                    </div>

                    <div id="fun-findings">
                        <repeat>
                            <template>
                                <obs conceptId="CIEL:167917" style="checkbox"
                                     answerConceptId="CIEL:{funId}"/>
                            </template>
                            <render funId="142429" message="Diabetic retinopathy"/>
                            <render funId="113271" message="Retinal detachment"/>
                            <render funId="124755" message="Thrombosis of retinal vein"/>
                            <render funId="142820" message="Deep retinal hemorrhage"/>
                            <render funId="143265" message="Cotton wool spots"/>
                            <render funId="119109" message="Optic nerve disease"/>
                        </repeat>
                    </div>
                </div>

            </p>

            <strong>
                <uimessage code="Diabetic foot"/>
            </strong>
            <p class="list-inline">
                <label>
                    <uimessage code="Foot examination performed"/>
                </label>
                <obs id="foot-exam" conceptId="PIH:14779" style="radio"
                     answerConceptIds="CIEL:1267,PIH:NOT DONE">
                    <controls>
                        <when value="CIEL:1267" thenDisplay="#foot-results"/>
                    </controls>
                </obs>

                <div id="foot-results" class="two-columns">
                    <div>
                        <p class="list-inline" style="margin-left: 30px">
                            <label>
                                <uimessage code="Foot exam findings"/>
                            </label>
                            <obs id="normal-foot" style="radio"
                                 conceptId="CIEL:1127" answerConceptIds="CIEL:1115,CIEL:1116">
                                <controls>
                                    <when value="CIEL:1116" thenDisplay="#abnormal-foot" />
                                </controls>
                            </obs>
                            <br/>
                        </p>

                    </div>
                    <div  id="abnormal-foot">
                        <repeat>
                            <template>
                                <obs id="dm-foot-{tag}-dx" conceptId="CIEL:165471" style="checkbox"
                                     answerConceptId="CIEL:{footId}">
                                    <controls>
                                        <when value="CIEL:132653" thenDisplay="#foot-numb-message" />
                                    </controls>
                                </obs>
                            </template>
                            <render footId="118983" message="Neuropathy" tag="neuropathy"/>
                            <render footId="132653" message="Loss of sensation" tag="numb"/>
                            <render footId="163411" message="Foot ulcer" tag="ulcer" />
                            <render footId="152805" message="Foot infection"/>

                        </repeat>

                        <p>
                            <label>
                                <uimessage code="Other foot exam comments"/>
                            </label>
                            <obs conceptId="PIH:14778" />
                        </p>

                        <p class="list-inline">
                            <label>
                                <uimessage code="Referred to surgery"/>
                            </label>
                            <obs conceptId="PIH:14781" style="radio"
                                 answerConceptIds="CIEL:1065,CIEL:1066"
                                 answerCodes="yes,no"/>
                        </p>

                        <div id="foot-numb-message">
                            <label>
                                <b>
                                    <uimessage code="  Ulcer prevention recommended"/>
                                </b>
                            </label>
                        </div>
                    </div>

                </div>

                <p class="list-inline">
                    <label>
                        <uimessage code="Improvement since last visit"/>
                    </label>
                    <obs conceptId="PIH:14782" style="radio"
                         answerConceptIds="CIEL:1065,CIEL:1066"
                         answerCodes="yes,no" />
                </p>

            </p>

            <p>
                <label>
                    <uimessage code="pihcore.remarks"/>:
                </label>
                <obs conceptId="PIH:11974"/>
            </p>

        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.ncd.htn">
        <div id="htn" class="section-container">

            <!-- this section is ONLY included for NCD intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <p class="side-by-side">
                    <label>
                        <uimessage code="Type of hypertension" />
                    </label>
                    <obs conceptId="PIH:11940" style="radio"
                         answerConceptIds="CIEL:140987,CIEL:113087"
                         answerCodes="Essential,Secondary"/>
                </p>
            </includeIf>

            <table>
                <tr>
                    <th width="30%">
                        <label>
                            <uimessage code="pihcore.stage.label"/>
                        </label>
                    </th>
                    <th>
                        <label>
                            <uimessage code="mirebalais.vitals.systolic.bp.title"/>
                        </label>
                    </th>
                    <th>
                        <label>
                            <uimessage code="mirebalais.vitals.diastolic.bp.title"/>
                        </label>
                    </th>
                </tr>

                    <tr>
                        <td valign="top">
                            <p class="side-by-side">
                                <obs conceptId="CIEL:165583" style="radio"
                                     answerConceptIds="CIEL:165206,CIEL:165203,CIEL:165204"
                                     answerCodes="Pre-HTN,1 (Mild),2 (Moderate)"
                                     answerSeparator="&lt;br /&gt;&lt;br /&gt;"/>
                            </p>
                        </td>
                        <td>
                            <label>
                                <uimessage code="&gt; 130 - 139" />
                            </label>
                            <br/>
                            <label>
                                <uimessage code="&gt; 140 - 159" />
                            </label>
                            <br/>
                            <label>
                                <uimessage code="&gt; 160" />
                            </label>

                            <br/>
                            <label>
                                <uimessage code="&gt; 180 (Oral medication and refer to the ward for observation)" />
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="&gt; 85 - 89" />
                            </label>
                            <br/>
                            <label>
                                <uimessage code="&gt; 90 - 99" />
                            </label>
                            <br/>
                            <label>
                                <uimessage code="&gt; 100" />
                            </label>
                            <br/>
                            <label>
                                <uimessage code="&gt; 120 (Oral medication and refer to the ward for observation)" />
                            </label>
                        </td>
                    </tr>
            </table>

            <br/>
            <p>
                <label>
                    <uimessage code="Hypertension summary"/>:
                </label>
                <obs conceptId="PIH:11971"/>
            </p>

            <strong>
                <uimessage code="Complications related to hypertension"/>
            </strong>
            <div class="two-columns">
                <div>
                    <repeat>
                        <template>
                            <obs conceptId="PIH:14456" style="checkbox"
                                 answerConceptId="{acid}" answerCode="{ansLabel}"/>
                        </template>
                        <render acid="CIEL:111103" ansLabel="Stroke"/>
                        <render acid="CIEL:145438" ansLabel="Chronic kidney disease (CKD)"/>
                        <render acid="CIEL:139069" ansLabel="Heart failure"/>
                        <render acid="CIEL:5622"   ansLabel="Other"/>
                    </repeat>
                </div>
                <div>
                    <label>
                        <uimessage code="if other, specify"/>
                    </label>
                    <obs conceptId="PIH:14457"/>
                </div>
            </div>

            <br/>
            <strong>
                <uimessage code="Hypertension followup indicators" />
            </strong>

            <obsgroup groupingConceptId="PIH:14462" showIfEmpty="false">
                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{xId}"/>
                                    </label>
                                    <obs id="htn-fui-{tog}" conceptId="{message}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown">
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#htn-fui-{tog}-details"/>
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render message="CIEL:1898"   xId="Patient condition improved" tog="improved"/>
                            <render message="CIEL:164075" xId="Overall treatment adherence" tog="adher"/>
                            <render message="CIEL:167819" xId="Missed doses in past week" tog="missed"/>
                            <render message="CIEL:167021" xId="Aware and understands the disease" tog="aware"/>
                            <render message="CIEL:167914" xId="Understands treatment" tog="understand"/>
                        </repeat>
                    </div>
                    <div id="htn-fui-missed-details">
                        <br/><br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"  />

                    </div>
                </div>

                <ifMode mode="VIEW" include="false">
                    <table align="left" style="font-size:small">
                        <tr>
                            <th colspan="2">
                                Definition of disease control
                            </th>
                            <td>
                                Blood pressure less than or equal to 150/80
                            </td>
                        </tr>
                    </table>
                </ifMode>

                <p class="list-inline-extra-wide">
                    <label>
                        <uimessage code="Disease control"/>
                    </label>
                    <obs conceptId="PIH:11506" style="radio"
                         answerConceptIds="PIH:11507,PIH:11508,PIH:11509"
                         answerCodes="controlled,uncontrolled,complications"/>
                </p>
            </obsgroup>
        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.ncd.heart_failure">
        <div id="heart_failure" class="section-container">
            <!-- this section is ONLY included for NCD intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <div class="two-columns">
                    <div>
                        <p class="side-by-side">
                            <strong>
                                <uimessage code="Main diagnosis"/>
                            </strong>

                            <repeat>
                                <template>
                                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox"
                                             answerConceptId="{diagId}"
                                             toggle="{tag}"/>
                                    </obsgroup>
                                    <br/>
                                </template>
                                <render diagId="CIEL:5016"   tag="cardiomyopathy" answers="" />
                                <render diagId="CIEL:113227" tag="rheumaticHeart" answers="" />
                                <render diagId="PIH:14836"   tag="degenHeart" answers="" />
                                <render diagId="CIEL:127376" tag="rtHeartFail" answers="" />
                                <render diagId="CIEL:119092" tag="pericardDisease" answers="" />
                                <render diagId="CIEL:120148" tag="arrythmia" answers="" />
                                <render diagId="CIEL:124800" tag="thromboemb" answers="" />
                                <render diagId="CIEL:119956" tag="congenitalHeart" answers="" />
                                <render diagId="PIH:12231"   tag="unknownHeart" answers="" />
                            </repeat>

                        </p>
                    </div>
                    <div>
                        <div id="cardiomyopathy">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="pihcore.ncd.cardiomyopathy"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:139529,CIEL:142317,CIEL:113918,CIEL:163712,CIEL:168116,CIEL:168128,PIH:14748"
                                         answerSeparator="&lt;br /&gt;" />
                                 </obsgroup>
                                <br/>
                                <obs conceptId="PIH:14752" style="checkbox"
                                     answerConceptId="PIH:14753" answerCode="unknown" />
                                <br/>
                                <obs conceptId="PIH:14752" style="checkbox"
                                     answerConceptId="PIH:14754" answerCode="other" />
                                <obs conceptId="PIH:14754" style="text" />
                            </p>

                        </div>

                        <div id="rheumaticHeart">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Rheumatic heart disease"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:127437,CIEL:127438,CIEL:127436,CIEL:127455,CIEL:127456,CIEL:127454,PIH:14750"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>
                            </p>
                        </div>

                        <div id="degenHeart">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Degenerative valve disease"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:134082,CIEL:115735,CIEL:121532,CIEL:148546,CIEL:134088"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>
                            </p>
                        </div>

                        <div id="rtHeartFail">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Right heart failure"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="PIH:COR PULMONALE,CIEL:117152"
                                         answerCodes="Cor pulmonale,Schistosomiasis"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>

                                <br/>
                                <obs conceptId="PIH:14752" style="checkbox"
                                     answerConceptId="PIH:14755" answerCode="unknown" />
                            </p>
                        </div>

                        <div id="pericardDisease">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Pericardial diseases"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:124033,CIEL:168127,CIEL:159343"
                                         answerCodes="Tuberculosis of pericardium,HIV pericardial diseases,Malignant pericardial effusion"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>
                            </p>
                        </div>

                        <div id="arrythmia">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Arrythmia"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:148203,CIEL:148202"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>
                            </p>
                        </div>

                        <div id="thromboemb">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Thromboembolic"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:113504,CIEL:119624"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>

                                <br/>
                                <obs conceptId="PIH:14752" style="checkbox"
                                     answerConceptId="PIH:14756" answerCode="other" />
                                <obs conceptId="PIH:14756" style="text" />
                            </p>
                        </div>

                        <div id="congenitalHeart">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Congenital heart disease"/>
                                </label>
                                <br/>
                                <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                    <obs conceptId="PIH:DIAGNOSIS" style="radio"
                                         answerConceptIds="CIEL:143049,CIEL:149461"
                                         answerSeparator="&lt;br /&gt;" />
                                </obsgroup>

                                <br/>
                                <label>
                                    <uimessage code="Additional comments:"/>
                                </label>
                                <br/>
                                <obs conceptId="PIH:14742"/>
                            </p>
                        </div>

                        <div id="unknownHeart">
                            <p class="side-by-side">
                                <label>
                                    <uimessage code="Unknown suspected, specify:"/>
                                </label>
                                <br/>
                                <obs conceptId="PIH:14742"/>
                            </p>
                        </div>
                    </div>

                </div>
                <br/>
            </includeIf>

            <div>
                <strong>
                    <uimessage code="Heart failure followup indicators"/>
                </strong>

                <obsgroup groupingConceptId="PIH:14724">
                    <repeat>
                        <template>
                            <p class="list-inline">
                                <label>
                                    <uimessage code="{questionName}"/>
                                </label>
                                <obs id="hf-fui-{tog}" conceptId="{qId}" style="radio"
                                     answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                     answerCodes="yes,no,unknown" />
                            </p>
                        </template>
                        <render qId="CIEL:168115" questionName="Low salt adherence diet" tog="salt" />
                    </repeat>

                </obsgroup>

                <div>
                    <repeat>
                        <template>
                            <p class="list-inline">
                                <obsgroup groupingConceptId="PIH:14733" showIfEmpty="false">
                                    <obs style="radio"
                                         conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT,PIH:SYMPTOM PRESENCE UNKNOWN"
                                         conceptLabels="yes,no,unknown" answerConceptId="{qId}" labelText="{symptName}"/>
                                </obsgroup>
                            </p>
                        </template>
                        <render qId="CIEL:122496" symptName="Dyspnea" />
                        <render qId="CIEL:131689" symptName="Orthopnea" />
                        <render qId="CIEL:130783" symptName="Paroxysmal nocturnal dyspnea" />
                        <render qId="CIEL:130166" symptName="Pitting edema" />
                        <render qId="CIEL:127640" symptName="Crackles" />
                        <render qId="CIEL:136394" symptName="Jugular distension" />
                        <render qId="PIH:14751"   symptName="Loud murmur" />
                    </repeat>
                </div>

                <obsgroup groupingConceptId="PIH:14724">
                    <p class="list-inline">
                        <label>
                            <uimessage code="pihcore.ncd.hf.vol_status"/>
                        </label>
                        <obs conceptId="CIEL:159574" style="radio"
                             answerConceptIds="CIEL:159575,CIEL:117315,CIEL:138099" />
                    </p>

                    <div class="two-columns">
                        <div>
                            <repeat>
                                <template>
                                    <p class="list-inline">
                                        <label>
                                            <uimessage code="{questionName}"/>
                                        </label>
                                        <obs id="hf-fui-{tog}" conceptId="{qId}" style="radio"
                                             answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                             answerCodes="yes,no,unknown" >
                                            <controls>
                                                <when value="PIH:YES" thenDisplay="#hf-fui-{tog}-details"/>
                                            </controls>
                                        </obs>
                                    </p>
                                </template>
                                <render qId="CIEL:1898"   questionName="Patient condition improved" tog="improved"/>
                                <render qId="CIEL:164075" questionName="Overall treatment adherence" tog="adher"/>
                                <render qId="CIEL:167819" questionName="Missed doses in past week" tog="missed"/>
                                <render qId="CIEL:167021" questionName="Aware and understands the disease" tog="aware"/>
                                <render qId="CIEL:167914" questionName="Understands treatment" tog="understand"/>
                                <render qId="PIH:14741"   questionName="Ability to titrate treatment" tog="titrate"/>

                                <render qId="PIH:14739"   questionName="Endocarditis prevention therapy" tog="endocard"/>
                                <render qId="PIH:14738"   questionName="Refer for surgery evaluation" tog="referSurg"/>
                                <render qId="PIH:14740"   questionName="Echocardiogram improvement" tog="echoImprov" />
                            </repeat>
                        </div>

                        <div id="hf-fui-missed-details">
                            <br/><br/>
                            <label>
                                <uimessage code="# of missed doses in past week"/>
                            </label>
                            <obs conceptId="CIEL:167918"  />
                        </div>
                    </div>

                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <obsgroup groupingConceptId="PIH:14733" showIfEmpty="false">
                                        <obs style="radio"
                                             conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT,PIH:SYMPTOM PRESENCE UNKNOWN"
                                             conceptLabels="yes,no,unknown" answerConceptId="{qId}" labelText="{symptName}"/>
                                    </obsgroup>
                                </p>
                            </template>
                            <render qId="CIEL:119664" symptName="Decompensated" />
                        </repeat>
                    </div>

                    <obsgroup groupingConceptId="PIH:14724">
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown" />
                                </p>
                            </template>
                            <render qId="CIEL:1788"   questionName="Send for admission" />
                        </repeat>

                    </obsgroup>

                    <label>
                        <uimessage code="If systolic function is depressed, treatment class:"/>
                    </label>
                    <div class="three-columns">
                        <repeat>
                            <template>
                                <div>
                                    <p class="side-by-side">
                                        <label>
                                            <uimessage code="{messg}" />
                                        </label>

                                        <obs conceptId="{cid}" style="radio"
                                             answerConceptIds="CIEL:1065,CIEL:1066"
                                             answerCodes="yes,no"/>
                                    </p>
                                </div>
                            </template>
                            <render cid="PIH:14531" short="ACE" messg="On ACE inhibitors" />
                            <render cid="PIH:14723" short="BBs" messg="On beta-blockers" />
                            <render cid="PIH:14811" short="Spirono" messg="On spironolactone" />
                        </repeat>

                    </div>
                </obsgroup>

            </div>

            <div>
                <p class="side-by-side">
                    <strong>
                        <uimessage code="pihcore.ncd.hf.nyhaClassification"/>
                    </strong>

                    <obs conceptId="PIH:NYHA CLASS" style="radio"
                         answerConceptIds="PIH:NYHA CLASS 1,PIH:NYHA CLASS 2,PIH:NYHA CLASS 3,PIH:NYHA CLASS 4"
                         answerCodes="I (No limitations),II (Comfortable with moderate exercise),III (Comfortable resting),IV (Not comfortable resting)"
                         answerSeparator="&lt;br /&gt;"/>
                </p>

                <strong>
                    <uimessage code="Cardiology referral"/>
                </strong>
                <obsgroup groupingConceptId="PIH:6329" showIfEmpty="false">
                    <div class="two-columns">
                        <div>
                            <p class="side-by-side">
                                <obs id="cardio-ref"
                                     conceptId="PIH:Fulfillment status" style="radio"
                                     answerConceptIds="CIEL:1267,CIEL:160068"
                                     answerCodes="yes,no" labelCode="Cardiology referral completed">
                                    <controls>
                                        <when value="CIEL:1267" thenDisplay="#cardio-ref-details"/>
                                    </controls>
                                </obs>
                            </p>
                        </div>
                        <div id="cardio-ref-details">
                            <obs conceptId="CIEL:163181" allowTime="false" allowFutureDates="true"
                                 labelText="Date of cardiology referral" />
                        </div>
                    </div>
                </obsgroup>

                <br/>

                <strong>
                    <uimessage code="Cardiac surgery"/>
                </strong>
                <obsgroup groupingConceptId="PIH:14725" showIfEmpty="false">
                    <p class="side-by-side">
                        <obs id="cardiac-surgery-sched"
                             conceptId="PIH:Scheduled surgery" style="radio"
                             answerConceptIds="CIEL:1065,CIEL:1066"
                             labelCode="Cardiac surgery scheduled" />
                    </p>
                </obsgroup>


                <obsgroup groupingConceptId="CIEL:160714" showIfEmpty="false">
                    <div class="two-columns">
                        <div>
                            <obs id="cardiac-surgery"
                                 conceptId="CIEL:1651" style="checkbox"
                                 answerConceptId="PIH:7827"
                                 answerCode="Cardiac surgery performed">
                                <controls>
                                    <when value="PIH:7827" thenDisplay="#cardiac-surgery-details"/>
                                </controls>
                            </obs>
                        </div>
                        <div id="cardiac-surgery-details">
                            <obs conceptId="CIEL:160715" allowTime="false"
                                 labelText="Date of surgery" />

                            <obs conceptId="CIEL:160716" labelText="Surgery complications" />
                        </div>
                    </div>
                </obsgroup>
            </div>
            <br/>

            <div>
                <label>
                    <uimessage code="pihcore.remarks"/>:
                </label>
                <obs conceptId="PIH:11973"/>
            </div>
        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Chronic lung disease">
        <div id="respire" class="section-container">

            <!-- Only include this section on the NCD intake form -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <table>
                    <tr>
                        <th colspan="3">
                            <label>
                                <uimessage code="Parenchymal lung diseases" />
                            </label>
                        </th>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <repeat>
                                <template>
                                    <obs conceptId="PIH:14599" style="checkbox"
                                         answerConceptId="{parId}" answerCode="{message}" />
                                </template>
                                <render parId="CIEL:116711" message="Diffuse parenchymal and interstitial" />
                                <render parId="PIH:14601"   message="Post infection (ie. TB)" />
                                <render parId="CIEL:167822" message="Occupation" />
                                <render parId="CIEL:5622"   message="Other" />
                            </repeat>
                        </td>
                    </tr>

                    <tr>
                        <th width="30%">
                            <label>
                                <uimessage code="Obstructive lung diseases "/>
                            </label>
                        </th>
                        <th>
                            <label>
                                <uimessage code="pihcore.symptoms"/>
                            </label>
                        </th>
                        <th>
                            <label>
                                <uimessage code="pihcore.suggestedTreatment.label"/>
                            </label>
                        </th>
                    </tr>

                    <repeat>
                        <template>
                            <tr>
                                <td>
                                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                        <obs conceptId="PIH:DIAGNOSIS" answerConceptId="{ncdId}"
                                             style="checkbox"/>
                                    </obsgroup>
                                </td>
                                <td>
                                    <label>
                                        <uimessage code="{symp}"/>
                                    </label>
                                </td>
                                <td>
                                    <label>
                                        <uimessage code="{sugTreat}"/>
                                    </label>
                                </td>
                            </tr>
                        </template>
                        <render ncdId="CIEL:1295" message="COPD" symp=""
                                sugTreat="Ipratropium, Beclomethasone" />
                        <render ncdId="CIEL:121375" message="Asthma" symp=""
                                sugTreat="Salbutamol, Beclomethasone, or Prednisolone"/>
                        <render ncdId="CIEL:121011" message="Bronchiectasis" symp="pihcore.symp.phlegm.label"
                                sugTreat="pihcore.ncd.resp.bronchiectTreatment.label"/>
                    </repeat>

                    <tr>
                        <td>
                            <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                <obs conceptId="PIH:DIAGNOSIS" style="checkbox"
                                     answerConceptId="CIEL:143381" answerCode="Cor pulmonale"/>
                            </obsgroup>
                        </td>
                        <td></td>
                        <td></td>
                    </tr>
                </table>
            </includeIf>

            <h3>COPD</h3>
            <table>
                <tr><th colspan="2">Modified MRC dyspnea scale</th></tr>
                <tr>
                    <td>mMRC Grade 0</td>
                    <td>I only get breathless with strenuous exercise (GOLD A)</td>
                </tr>
                <tr>
                    <td>mMRC Grade 1</td>
                    <td>I get short of breath when hurrying on the level or walking up a
                        slight hill (GOLD A)</td>
                </tr>
                <tr>
                    <td>mMRC Grade 2</td>
                    <td>I walk slower than people of the same age on the level because
                        of breathlessness or have to stop for breath when walking at my
                        own pace on the level </td>
                </tr>
                <tr>
                    <td>mMRC Grade 3</td>
                    <td>I stop for breath after walking about 100 yards or after a few
                        minutes on the level</td>
                </tr>
                <tr>
                    <td>mMRC Grade 4</td>
                    <td>I am too breathless to leave the house or I am breathless
                        when dressing</td>
                </tr>
            </table>
            <br/><br/>

            <table>
                <tr>
                    <th rowspan="2">
                        GOLD 'ABCD' groups<br/>
                        Assessment of symptoms and risks of exacerbations for initiation of COPD therapy
                    </th>
                    <th colspan="2">Assess symptoms</th>
                </tr>
                <tr>
                    <th>mMRC 0 to 1</th>
                    <th>mMRC 2+</th>
                </tr>
                <tr>
                    <td>Assess exacerbation risk Exacerbations./ Hospitalizations</td>
                    <td>A</td>
                    <td>B</td>
                </tr>
                <tr>
                    <td>2+ exacerbations or 1+ hospitalization</td>
                    <td>C</td>
                    <td>D</td>
                </tr>

            </table>
            <br/><br/>

            <div class="two-columns">
                <div>
                    <strong>
                        <uimessage code="pihcore.ncd.copdClass"/>
                    </strong>
                    <p class="side-by-side">
                        <obs conceptId="PIH:COPD group classification" style="radio"
                             answerConceptIds="CIEL:165441,CIEL:165442,CIEL:165443,CIEL:165444"
                             answerCodes="pihcore.gradeA,pihcore.gradeB,pihcore.gradeC,pihcore.gradeD"
                             answerSeparator="&lt;br /&gt;"/>
                    </p>

                    <p class="side-by-side">
                        <label>
                            <uimessage code="On medication with" />
                        </label>
                        <br/>
                        <obs conceptId="PIH:14603" style="radio"
                             answerConceptIds="PIH:14604,PIH:14605,PIH:14606,PIH:14607,PIH:14608,PIH:14609"
                             answerCodes="SABA (Short-acting beta-agonist),SAMA (Short-acting muscarinic antagonist),LABA (Long-acting beta-agonist),LAMA (Long acting muscarinic antagonist),Oral steroid,Steroid inhaler"
                             answerSeparator="&lt;br /&gt;"/>
                    </p>
                </div>

                <div>
                    <dl>
                        <dt>
                            <uimessage code="SABA"/>
                        </dt>
                        <dd>
                            <uimessage code="Salbutamol"/>
                        </dd>

                        <dt>
                            <uimessage code="SAMA"/>
                        </dt>
                        <dd>
                            <uimessage code="Ipratropium bromide"/>
                        </dd>

                        <dt>
                            <uimessage code="LABA"/>
                        </dt>
                        <dd>
                            <uimessage code="Salmeterol, Formoterol, Indacaterol"/>
                        </dd>

                        <dt>
                            <uimessage code="LAMA"/>
                        </dt>
                        <dd>
                            <uimessage code="Tiotropium"/>
                        </dd>

                        <dt>
                            <uimessage code="Inhaled steroids"/>
                        </dt>
                        <dd>
                            <uimessage code="Budesonide"/>
                        </dd>
                    </dl>
                </div>
            </div>

            <strong>
                <uimessage code="COPD evaluation" />
            </strong>

            <obsgroup groupingConceptId="PIH:14620">
                <repeat>
                    <template>
                        <p class="list-inline-wide">
                            <label>
                                <uimessage code="{copdSym}" />
                            </label>

                            <obs conceptId="{copdId}" style="radio"
                                 answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1067"
                                 answerCodes="yes,no,unknown" />
                        </p>
                    </template>
                    <render copdId="CIEL:158939" copdSym="Smoking cessation" />
                </repeat>

                <repeat>
                    <template>
                        <p class="side-by-side">
                            <obs style="radio"
                                 conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT,PIH:SYMPTOM PRESENCE UNKNOWN"
                                 conceptLabels="yes,no,unknown" answerConceptId="{copdId}" labelText="{copdSym}"/>
                        </p>
                    </template>
                    <render copdId="CIEL:122496" copdSym="Dyspnea" />
                    <render copdId="CIEL:124665" copdSym="Chest tightness" />
                    <render copdId="CIEL:5209"   copdSym="Wheezing" />
                    <render copdId="CIEL:143264" copdSym="Cough" />
                    <render copdId="CIEL:5957"   copdSym="Productive cough" />
                </repeat>

                <repeat>
                    <template>
                        <p class="list-inline-wide">
                            <label>
                                <uimessage code="{copdSym}" />
                            </label>

                            <obs conceptId="{copdId}" style="radio"
                                 answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1067"
                                 answerCodes="yes,no,unknown" />
                        </p>
                    </template>
                    <render copdId="PIH:14622"   copdSym="Increased inhaler use" />
                    <render copdId="PIH:14623"   copdSym="Wheeze during exam" />
                    <render copdId="PIH:11925"   copdSym="Activity limitation" />
                    <render copdId="PIH:14626"   copdSym="Night waking due to dyspnea" />
                </repeat>

                <table>
                    <tr><th>
                        Exacerbation Definition (one or more):
                    </th></tr>
                    <tr>
                        <td>
                            <sl>
                                <li>Worsening Dyspnea</li>
                                <li>Sputum production increases and/or become thicker</li>
                                <li>Cough increases in frequency and severity</li>
                            </sl>
                        </td>
                    </tr>
                </table>

                <p class="list-inline-wide">
                    <label>
                        <uimessage code="COPD exacerbation" />
                    </label>

                    <obs id="exar-copd" conceptId="CIEL:166093" style="radio"
                         answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1067"
                         answerCodes="yes,no,unknown" >
                        <controls>
                            <when value="CIEL:1065" thenDisplay="#details-exar-copd" />
                        </controls>
                    </obs>
                </p>

                <div id="details-exar-copd" style="margin-left: 30px">
                    <label>
                        <uimessage code="Number of COPD exacerbations since last visit" />
                    </label>

                    <obs conceptId="CIEL:167821" />
                    <br/>
                    <p class="list-inline-wide">
                        <label>
                            <uimessage code="If exacerbation, hospitalization needed?" />
                        </label>

                        <obs conceptId="PIH:14626" style="radio"
                             answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1067"
                             answerCodes="yes,no,unknown" />
                    </p>
                </div>
            </obsgroup>

            <h3>Asthma</h3>

            <div class="two-columns">
                <div>
                    <strong>
                        <uimessage code="GINA assessment asthma control " />
                    </strong>
                    <i>(In the past 4 weeks)</i>
                    <obsgroup groupingConceptId="PIH:14587">
                        <repeat>
                            <template>
                                <p class="side-by-side">
                                    <label>
                                        <uimessage code="{message}"/>
                                    </label>
                                    <br/>
                                    <obs conceptId="PIH:{ginaId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO"
                                         answerCodes="yes,no"/>
                                </p>
                            </template>
                            <render ginaId="14618" message="Exacerbations (more than or equal to 1)" />
                            <render ginaId="11803" message="Datetime symptoms more than twice a week" />
                            <render ginaId="11991" message="Inhaler for symptoms more than twice a week" />
                            <render ginaId="11925" message="Activity limitations due to asthma" />
                            <render ginaId="11731" message="Night waking due to asthma" />
                            <render ginaId="14619" message="Triggers cause exacerbation of asthma" />
                        </repeat>
                    </obsgroup>
                </div>
                <div>
                    <p class="side-by-side">
                        <strong>
                            <uimessage code="Asthma severity"/>
                        </strong>
                        <obs conceptId="PIH:7405" style="radio"
                             answerConceptIds="CIEL:1498,CIEL:1499,CIEL:1500"
                             answerSeparator="&lt;br /&gt;"/>
                    </p>
                    <br/><br/>

                    <strong>
                        <uimessage code="Inhaler" />
                    </strong>

                    <div>
                        <p class="list-inline">
                            <label>
                                <uimessage code="pihcore.ncd.inhalerEd"/>
                            </label>
                            <br/>
                            <obs conceptId="PIH:7399" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO,CIEL:1067"
                                 answerCodes="yes,no,unknown"/>

                        </p>

                        <p class="list-inline">
                            <label>
                                <uimessage code="Good inhaler technique"/>
                            </label>
                            <br/>
                            <obs conceptId="PIH:7397" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO,CIEL:1067"
                                 answerCodes="yes,no,unknown"/>
                        </p>
                    </div>
                </div>
            </div>

            <strong>
                Chronic lung disease followup indicators
            </strong>
            <obsgroup groupingConceptId="PIH:14812">
                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs id="lung-fui-{tog}" conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown" >
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#lung-fui-{tog}-details"/>
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render qId="CIEL:1898"   questionName="Patient condition improved" tog="improved"/>
                            <render qId="CIEL:164075" questionName="Overall treatment adherence" tog="adher"/>
                            <render qId="CIEL:167819" questionName="Missed doses in past week" tog="missed"/>
                            <render qId="CIEL:167021" questionName="Aware and understands the disease" tog="aware"/>
                            <render qId="CIEL:167914" questionName="Understands treatment" tog="understands"/>
                            <render qId="PIH:14741"   questionName="Ability to titrate treatment" tog="titrate" />
                        </repeat>
                    </div>

                    <div id="lung-fui-missed-details">
                        <br/><br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"  />
                    </div>
                </div>
            </obsgroup>

            <h3>
                <uimessage code="Spirometry" />
            </h3>

            <obsgroup groupingConceptId="PIH:14610">
                <div class="two-columns">
                    <div>
                        <obs conceptId="CIEL:163724" labelText="Date" allowTime="false"/>
                        <br/>

                        <table style="width: 400px">
                            <tr>
                                <th>FEV1 value</th>
                                <th>COPD stage</th>
                            </tr>
                            <tr>
                                <td>FEV1 80% or above</td>
                                <td>mild</td>
                            </tr>
                            <tr>
                                <td>FEV1 50 - 79%</td>
                                <td>moderate</td>
                            </tr>
                            <tr>
                                <td>FEV1 30 - 49%</td>
                                <td>severe</td>
                            </tr>
                            <tr>
                                <td>FEV1 29% or less</td>
                                <td>very severe</td>
                            </tr>
                            <tr>
                                <td colspan="2"><b>FEV1 normal and FVC decreased:</b><br/>suspect interstitial lung diseases</td>
                            </tr>
                        </table>
                    </div>

                    <div>
                        <repeat>
                            <template>
                                <obs conceptId="{spiroId}" labelText="{spironame}"/>
                            </template>
                            <render spiroId="PIH:14611" spironame="FEV1"/>
                            <render spiroId="PIH:14612" spironame="FVC"/>
                        </repeat>

                        <repeat>
                            <template>
                                <p class="side-by-side">
                                    <obs conceptId="{spiroId}" labelText="{spironame}" style="radio"
                                         answerConceptIds="{answIds}"/>
                                </p>
                            </template>
                            <render spiroId="PIH:14613" spironame="FEV1/FVC"
                                    answIds="CIEL:1115,CIEL:164471,CIEL:164470"/>
                            <render spiroId="PIH:14614" spironame="Post-bronchodilator" answIds="CIEL:703,CIEL:664"/>
                        </repeat>
                    </div>
                </div>
            </obsgroup>
            <br/>

            <p class="side-by-side">
                <label>
                    <uimessage code="Spirometry progress" />
                </label>
                <obs conceptId="PIH:14617" style="radio"
                     answerConceptIds="CIEL:162677,CIEL:162678,CIEL:162679" />
            </p>

            <div>
                <label>
                    <uimessage code="pihcore.remarks"/>:
                </label>
                <obs conceptId="PIH:11972"/>
            </div>
        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Chronic kidney disease (CKD) / Nephrotic Syndrome">
        <div id="kidney_failure" class="section-container">

            <!-- this section is ONLY included for NCD intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <p>
                    <label>
                        <uimessage code="Chronic renal failure secondary to:" />
                    </label>
                    <repeat>
                        <template>
                            <obs conceptId="PIH:14765" style="checkbox"
                                 answerConceptId="{answId}" />

                        </template>
                        <render answId="CIEL:117399" diagName="htn" />
                        <render answId="CIEL:119481" diagName="dm" />
                        <render answId="CIEL:1067"   diagName="unknown" />
                        <render answId="CIEL:155008" diagName="NSAID" />
                        <render answId="CIEL:149486" diagName="acuteTubularNecrosis" />
                        <render answId="CIEL:117780" diagName="Glomerulonephritis" />
                    </repeat>

                    <!-- Other free-text -->
                    <obs conceptId="PIH:14765" style="checkbox"
                         answerConceptId="CIEL:5622"
                         answerCode="pihcore.other"
                         showCommentField="true" commentFieldCode="zl.ifOtherSpecify" />
                </p>

                <p class="side-by-side">
                    <label>
                        <uimessage code="Biopsy performed" />
                    </label>
                    <obs id="renal-biobsy" conceptId="PIH:14815" style="radio"
                         answerConceptIds="CIEL:1065,CIEL:1066"
                         answerCodes="yes,no">
                        <controls>
                            <when value="CIEL:1065" thenDisplay="#biopsy-details"/>
                        </controls>
                    </obs>

                    <div id="biopsy-details" style="margin-left: 30px">
                        <obs conceptId="PIH:3597" labelCode="Biopsy results"/>
                    </div>

                </p>

                <p>
                    <label>
                        <uimessage code="Nephrotic syndrome likely related with:" />
                    </label>
                    <repeat>
                        <template>
                            <obs conceptId="PIH:14766" style="checkbox"
                                 answerConceptId="{answId}"
                                 answerCode="{diagName}"/>

                        </template>
                        <render answId="CIEL:115745" diagName="Minimal change glomerulonephritis" />
                        <render answId="PIH:14767" diagName="Membraneous glomerulonephritis" />
                    </repeat>

                    <!-- other free-text -->
                    <obs conceptId="PIH:14766" style="checkbox"
                         answerConceptId="CIEL:5622"
                         answerCode="pihcore.other"
                         showCommentField="true" commentFieldCode="zl.ifOtherSpecify" />
                </p>
            </includeIf>

            <div class="two-columns">
                <div>
                    <strong>
                        CKD Stage
                    </strong>
                    <p class="side-by-side">
                        <obs conceptId="CIEL:165570" style="radio"
                             answerConceptIds="CIEL:120575,CIEL:120574,CIEL:120579,CIEL:120578,CIEL:120577"
                             answerLabels="Stage 1,Stage 2,Stage 3,Stage 4,Stage 5"
                             answerSeparator="&lt;br /&gt;" />
                    </p>
                </div>
                <div>
                    <label>
                        <br/>Stage 1: with normal or high GFR (GFR &gt; 90 mL/min)
                        <br/>Stage 2: Mild CKD (GFR = 60-89 mL/min)
                        <br/>Stage 3: Moderate CKD (GFR = 45-59 mL/min)
                        <br/>Stage 3B: Moderate CKD (GFR = 30-44 mL/min)
                        <br/>Stage 4: Severe CKD (GFR = 15-29 mL/min)
                        <br/>Stage 5: End Stage CKD (GFR &lt; 15 mL/min)
                    </label>
                </div>
            </div>

            <strong>
                <uimessage code="CKD and Nephrotic Syndrome followup indicators"/>
            </strong>

            <div>
                <repeat>
                    <template>
                        <p class="side-by-side">
                            <obsgroup groupingConceptId="PIH:14732" showIfEmpty="false">
                                <obs style="radio"
                                     conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT,PIH:SYMPTOM PRESENCE UNKNOWN"
                                     conceptLabels="yes,no,unknown" answerConceptId="{qId}" labelText="{symptName}"/>
                            </obsgroup>
                        </p>
                    </template>
                    <render qId="CIEL:460"    symptName="Edema" />
                    <render qId="CIEL:121629" symptName="Anemia" />
                    <render qId="CIEL:117441" symptName="Hyperlipidemia" />
                </repeat>
            </div>

            <obsgroup groupingConceptId="PIH:14717" showIfEmpty="false" >
                <p class="list-inline-wide">
                    <label>
                        <uimessage code="CKD/nephrotic syndrome control"/>
                    </label>
                    <obs conceptId="PIH:11506" style="radio"
                         answerConceptIds="PIH:11507,PIH:11508,PIH:11509"
                         answerCodes="controlled,uncontrolled,complications" />
                </p>
                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs id="ckd-fui-{tog}" conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,CIEL:1067"
                                         answerCodes="yes,no,unknown" >
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#ckd-fui-{tog}-details"/>
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render qId="PIH:14716"   questionName="HTN controlled" tog="control"/>
                            <render qId="PIH:14718"   questionName="Stable creatinine level" tog="creatinine" />
                            <render qId="CIEL:128340" questionName="Proteinuria" tog="pu"/>

                            <render qId="CIEL:1898"   questionName="Patient condition improved" tog="improved"/>
                            <render qId="CIEL:164075" questionName="Overall treatment adherence" tog="adher"/>
                            <render qId="CIEL:167819" questionName="Missed doses in past week" tog="missed"/>
                            <render qId="CIEL:167021" questionName="Aware and understands the disease" tog="aware"/>
                            <render qId="CIEL:167914" questionName="Understands treatment" tog="understands"/>

                            <render qId="PIH:14719"   questionName="Dialysis referral" tog="dialysis"/>
                            <render qId="PIH:14720"   questionName="On dialysis" tog="onDial"/>

                            <render qId="PIH:14721"   questionName="Glomerulonephritis relapse" tog="glomer" />
                        </repeat>
                    </div>

                    <div id="ckd-fui-missed-details">
                        <br/><br/><br/><br/><br/><br/><br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"  />

                    </div>
                </div>
            </obsgroup>

            <p>
                <label>
                    <uimessage code="pihcore.remarks"/>:
                </label>
                <obs conceptId="PIH:14813"/>
            </p>
        </div>
    </section>

    <section sectionTag="fieldset"
             headerTag="legend" headerStyle="title" headerCode="Liver cirrhosis / Hepatitis B">
        <div id="cirrhosis" class="section-container">

            <!-- this section is ONLY included for NCD intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <strong>
                    <uimessage code="Diagnosis"/>
                </strong>
                <div class="two-columns">
                    <div>
                        <p class="side-by-side">
                            <repeat>
                                <template>
                                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox"
                                             answerConceptId="{diagId}" answerCode="{name}"/>
                                    </obsgroup>
                                    <br/>
                                </template>
                                <render diagId="CIEL:120557" name="Chronic Hepatitis B" />
                                <render diagId="CIEL:145347" name="Chronic Hepatitis C" />
                            </repeat>
                        </p>

                        <label>
                            <uimessage code="Hepatocarcinoma secondary"/>
                        </label>
                        <p class="side-by-side">
                            <repeat>
                                <template>
                                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox"
                                             answerConceptId="{diagId}" answerCode="{name}"/>
                                    </obsgroup>
                                    <br/>
                                </template>
                                <render diagId="CIEL:168297" name="Hepatocarcinoma due to Hepatitis B" />
                                <render diagId="CIEL:168298" name="Hepatocarcinoma due to Hepatitis C" />
                                <render diagId="PIH:14911"   name="Hepatocarcinoma due to unknown cause" />
                            </repeat>
                        </p>
                    </div>
                    <div>
                        <label>
                            <uimessage code="Liver cirrhosis secondary"/>
                        </label>
                        <p class="side-by-side">
                            <repeat>
                                <template>
                                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox"
                                             answerConceptId="{diagId}" answerCode="{name}"/>
                                    </obsgroup>
                                    <br/>
                                </template>
                                <render diagId="CIEL:168300" name="Cirrhosis due to Hepatitis B" />
                                <render diagId="CIEL:168301" name="Cirrhosis due to Hepatitis C" />
                                <render diagId="CIEL:149157" name="Alcoholic cirrhosis" />
                                <render diagId="CIEL:168302" name="Cirrhosis schistosomiasis" />
                                <render diagId="PIH:14910"   name="Non-alcoholic steatohepatitis" />
                                <render diagId="CIEL:146184" name="Cardiac cirrhosis" />
                                <render diagId="CIEL:143118" name="Unknown" fullName="Cryptogenic cirrhosis" />
                            </repeat>
                        </p>

                    </div>
                </div>
            </includeIf>

            <br/>
            <strong>
                <uimessage code="Liver followup indicators"/>
            </strong>

            <ifMode mode="VIEW" include="false">
                <table align="left" style="font-size:small">
                    <tr>
                        <th colspan="2">
                            Indications for treatment
                        </th>
                        <td>
                            APRI > 1.5 or USS Cirrhosis<br/>
                            VL from 2000 and ALT > 1.5 times 40 (at least 2 times in 4 months)<br/>
                            Coinfection VHC-VIH<br/>
                            VL from 2000 in pregnant women
                        </td>
                    </tr>
                </table>
            </ifMode>

            <div>
                <repeat>
                    <template>
                        <p class="list-inline">
                            <obsgroup groupingConceptId="PIH:14875" showIfEmpty="false">
                                <obs style="radio"
                                     conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT,PIH:SYMPTOM PRESENCE UNKNOWN"
                                     conceptLabels="yes,no,unknown"
                                     answerConceptId="{qId}" labelText="{symptName}"/>
                            </obsgroup>
                        </p>
                    </template>
                    <render qId="CIEL:168289" symptName="Asymptomatic" />
                    <render qId="CIEL:168295" symptName="Ascitic paracentesis" />
                    <render qId="CIEL:139582" symptName="Gastrointestinal bleeding" />
                    <render qId="CIEL:120345" symptName="Confusion" />
                    <render qId="CIEL:879"    symptName="Pruritus" />
                    <render qId="CIEL:159449" symptName="Alcohol use" />
                </repeat>
            </div>

            <obsgroup groupingConceptId="PIH:14827" showIfEmpty="false">
                <p class="list-inline">
                    <label>
                        <uimessage code="Disease control"/>
                    </label>
                    <obs conceptId="PIH:11506" style="radio"
                         answerConceptIds="PIH:11507,PIH:11508,PIH:11509"
                         answerCodes="controlled,uncontrolled,complications" />
                </p>

                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs id="liver-{tog}" conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown">
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#liver-{tog}-details"/>
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render qId="CIEL:1898"   questionName="Patient condition improved" tog="fui-improved"/>
                            <render qId="CIEL:164075" questionName="Overall treatment adherence" tog="fui-adher"/>
                            <render qId="CIEL:167819" questionName="Missed doses in past week" tog="fui-miss"/>
                            <render qId="CIEL:167021" questionName="Aware and understands the disease" tog="fui-aware"/>
                            <render qId="CIEL:167914" questionName="Understands treatment" tog="fui-under"/>
                            <render qId="PIH:14741"   questionName="Ability to titrate treatment" tog="fui-tite"/>
                            <render qId="CIEL:1788"   questionName="Need hospitalization today" tog="fui-hosp" />
                        </repeat>

                        <p class="side-by-side">
                            <label>
                                <uimessage code="New indication for Hepatitis B treatment"/>
                            </label>
                            <obs id="new-hepb-tto" conceptId="PIH:14889" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO"
                                 answerCodes="yes,no">
                                <controls>
                                    <when value="PIH:YES" thenDisplay="#new-hepb-reason"/>
                                </controls>
                            </obs>

                            <div id="new-hepb-reason" style="margin-left: 30px">
                                <p>
                                    <repeat>
                                        <template>
                                                <obs conceptId="PIH:14914" style="checkbox"
                                                     answerConceptId="{qId}"
                                                     answerCode="{answId}" />
                                        </template>
                                        <render qId="PIH:14912"   answId="Cirrhosis USS" />
                                        <render qId="CIEL:168288" answId="Cirrhosis APRI" />
                                        <render qId="CIEL:654"    answId="ALT / SGPT" />
                                        <render qId="CIEL:168323" answId="Hep B DNA (VL)" />
                                        <render qId="CIEL:1169"   answId="Co-infected with HIV" />
                                        <render qId="CIEL:156590" answId="Co-infected with Hepatitis C" />
                                        <render qId="CIEL:111491" answId="Pregnancy and VL &gt; 20,000" />
                                    </repeat>
                                </p>
                            </div>
                        </p>
                    </div>

                    <div id="liver-fui-miss-details">
                        <br/>
                        <br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"/>
                    </div>
                </div>

            </obsgroup>

            <obsgroup groupingConceptId="PIH:14890" showIfEmpty="false">
                <br/>
                <strong>
                    <uimessage code="Hepatitis B treatment"/>
                </strong>
                <p class="side-by-side">
                    <obs id="hepB-q" conceptId="PIH:14889" style="radio"
                         labelCode="On treatment"
                         answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1175"
                         answerCodes="yes,no,not applicable">
                        <controls>
                            <when value="CIEL:1065" thenDisplay="#hepB-details" />
                        </controls>
                    </obs>
                </p>

                <div id="hepB-details" style="margin-left: 30px">
                    <p class="side-by-side">
                        <repeat>
                            <template>
                                <obs conceptId="PIH:14888" style="checkbox"
                                         answerConceptId="{medId}" answerCode="{name}"/>
                                <br/>
                            </template>
                            <render medId="CIEL:84795" name="Tenofovir" />
                            <render medId="CIEL:75694" name="Entecav" />
                        </repeat>
                    </p>

                    <p class="list-inline-wide">
                        <label>
                            <uimessage code="Secondary effects"/>
                        </label>
                        <obs style="radio"
                             conceptId="CIEL:162871"
                             answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1175"
                             answerCodes="yes,no,not applicable" />
                    </p>
                    <p class="list-inline-wide">
                        <label>
                            <uimessage code="Missed doses in the last week"/>
                        </label>
                        <obs style="radio"
                             conceptId="CIEL:167819"
                             answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1175"
                             answerCodes="yes,no,not applicable" />

                    </p>
                    <p class="list-inline-wide">
                        <label>
                            <uimessage code="Response to treatment (after 1 year)"/>
                        </label>
                        <br/>
                        <obs style="radio"
                             conceptId="PIH:14892"
                             answerConceptIds="CIEL:1775,CIEL:162677,PIH:2416"
                             answerCodes="complete (undetectable VL),partial (decrease but persistent),no response" />
                    </p>
                </div>
            </obsgroup>
        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Palliative care">
        <div id="palliative" class="section-container">

            <!-- Only show on intake -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'ae06d311-1866-455b-8a64-126a9bd74171'">
                <div class="two-columns">
                    <div>
                        <label>
                            <uimessage code="Non-tumoral diseases" />
                        </label>

                        <repeat>
                            <template>
                                <obs conceptId="PIH:14773"
                                     style="checkbox"
                                     answerConceptId="{dId}" />
                                <!-- answerCode="{message}" -->
                            </template>
                            <render dId="PIH:14772"   message="Refractory heart disease" />
                            <render dId="CIEL:155569" message="CLD" />
                            <render dId="CIEL:145438" message="CKD" />
                        </repeat>

                        <!-- ToDo:  Add other -->
                    </div>
                    <div>
                        <label>
                            <uimessage code="Tumoral diseases" />
                        </label>

                        <repeat>
                            <template>
                                <obs conceptId="PIH:14773"
                                     style="checkbox"
                                     answerConceptId="{dId}"
                                     answerCode="{message}" />
                            </template>
                            <render dId="CIEL:116066" message="Hepatocarcinoma" />
                            <render dId="CIEL:134788" message="Prostate cancer" />
                            <render dId="CIEL:116026" message="Breast cancer" />
                            <render dId="CIEL:133328" message="Lung cancer" />
                            <render dId="PIH:14771"   message="Hematology cancer" />
                        </repeat>

                        <!-- Other with free-text -->
                        <obs conceptId="PIH:14773"
                             style="checkbox"
                             answerConceptId="CIEL:5622" answerCode="other"
                             commentFieldCode="zl.ifOtherSpecify" />
                    </div>
                </div>
            </includeIf>

            <strong>
                <uimessage code="Palliative followup indicators"/>
            </strong>

            <p class="list-inline-wide">
                <label>
                    <uimessage code="Counselling done" />
                </label>
                <obs conceptId="CIEL:165310" style="radio"
                     answerConceptIds="CIEL:1267,CIEL:1118"
                     answerCodes="yes,no"/>
            </p>

            <obsgroup groupingConceptId="PIH:14817" showIfEmpty="false">
                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p>
                                    <p class="list-inline">
                                        <label>
                                            <uimessage code="{xId}"/>
                                        </label>
                                        <obs id="pall-fui-{tog}" conceptId="{message}" style="radio"
                                             answerConceptIds="PIH:YES,PIH:NO,CIEL:1067"
                                             answerCodes="yes,no,unknown">
                                            <controls>
                                                <when value="PIH:YES" thenDisplay="#pall-fui-{tog}-details"/>
                                            </controls>
                                        </obs>
                                    </p>
                                </p>
                            </template>
                            <render message="CIEL:1898"   xId="Patient condition improved" tog="improved"/>
                            <render message="CIEL:164075" xId="Overall treatment adherence" tog="adher"/>
                            <render message="CIEL:167819" xId="Missed doses in past week" tog="missed"/>
                            <render message="CIEL:167021" xId="Aware and understands the disease" tog="aware"/>
                            <render message="CIEL:167914" xId="Understands treatment" tog="understand"/>
                            <render message="PIH:14741"   xId="Ability to titrate diuretic" tog="titrate"/>
                        </repeat>
                    </div>
                    <div id="pall-fui-missed-details">
                        <br/><br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"  />

                    </div>
                </div>
            </obsgroup>

            <table>
                <repeat>
                    <template>
                        <obsgroup groupingConceptId="PIH:14859" showIfEmpty="false">
                            <tr>
                                <td id="{symptName}-symp" colspan="3">
                                    <obs conceptId="CIEL:1728" style="checkbox"
                                         answerConceptId="{qId}"
                                         toggle="{id: '{symptName}-details', style: 'hidden'}" class="symptom-checkbox"/>
                                </td>
                            </tr>
                            <tr id="{symptName}-details" >
                                <td></td>
                                <td>
                                    <p class="list-inline">
                                        <obs conceptId="CIEL:162676" style="radio"
                                             answerConceptIds="CIEL:1107,CIEL:162677,CIEL:162678,CIEL:162679"
                                             answerCodes="no,better,worse,same" />
                                    </p>
                                </td>
                                <td>
                                    <p class="list-inline">
                                        <obs conceptId="PIH:14768" style="radio"
                                             answerConceptIds="PIH:11507,PIH:11508"
                                             answerCodes="controlled,uncontrolled"/>
                                    </p>
                                </td>
                            </tr>

                        </obsgroup>
                    </template>
                    <render qId="CIEL:114403" symptName="Pain" />
                    <render qId="CIEL:5978"   symptName="Nausea" />
                    <render qId="CIEL:996"    symptName="Constipation" />
                    <render qId="CIEL:116743" symptName="Insomnia" />
                    <render qId="CIEL:5226"   symptName="Weakness" />
                    <render qId="CIEL:136443" symptName="Jaundice" />
                    <render qId="CIEL:122496" symptName="Dyspnea" />
                </repeat>
            </table>
            <br/><br/>

            <p class="list-inline">
                <strong>
                    <uimessage code="pihcore.oncologyConsult.ecog_performance_status" />
                </strong>
                <obs conceptId="CIEL:160379" style="radio"
                     answers="0,1,2,3,4,5"
                     answerLabels="0,1,2,3,4,5"/>


            <ifMode mode="VIEW" include="false">

                    <table align="left" style="font-size:small">
                        <tr>
                            <td>0</td>
                            <td><uimessage code="pihcore.oncologyConsult.performance_status_0"/></td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td><uimessage code="pihcore.oncologyConsult.performance_status_1"/></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td><uimessage code="pihcore.oncologyConsult.performance_status_2"/></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td><uimessage code="pihcore.oncologyConsult.performance_status_3"/></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td><uimessage code="pihcore.oncologyConsult.performance_status_4"/></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td><uimessage code="pihcore.oncologyConsult.performance_status_5"/></td>
                        </tr>
                    </table>

            </ifMode>
            </p>

            <p class="list-inline">
                <label>
                    <br/>
                    <uimessage code="Hospitalization required" />
                </label>
                <obs id="palliative-hosp" style="radio"
                     conceptId="CIEL:1788" answerConceptIds="CIEL:1065,CIEL:1066">
                    <controls>
                        <when value="CIEL:1065" thenDisplay="#hosp-pall-reason" />
                    </controls>
                </obs>

                <div id="hosp-pall-reason" style="margin-left: 30px">
                    <label>Reasons for hospitalization</label>

                    <repeat>
                        <template>
                            <obs conceptId="CIEL:1887" style="checkbox"
                                 answerConceptId="{qId}"/>
                        </template>
                        <render qId="CIEL:142412" symptName="Diarrhea" />
                        <render qId="CIEL:122983" symptName="Vomiting" />
                        <render qId="PIH:7103"    symptName="Uncontrolled pain" />
                    </repeat>

                    <obs conceptId="CIEL:1887" style="checkbox"
                         answerConceptId="CIEL:5622"
                         answerCode="pihcore.other"
                         showCommentField="true" commentFieldCode="zl.ifOtherSpecify" />
                </div>

                <br/>
                <label>
                    <uimessage code="Additional comments:"/>
                </label>
                <br/>
                <obs conceptId="PIH:14816"/>
            </p>
        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Sickle cell">
        <div id="sickle" class="section-container">
            <strong>
                <uimessage code="On treatment"/>
            </strong>
            <br/>
            <repeat>
                <template>
                    <obs conceptId="PIH:14857" style="checkbox"
                         answerConceptId="{qId}" answerCode="{medName}"/>
                </template>
                <render qId="CIEL:76613" medName="Folic acid"/>
                <render qId="CIEL:81724" medName="Penicillin"/>

                <!-- ToDo: Is hydroxyurea needed since it's asked later? -->
                <render qId="CIEL:77795" medName="Hydroxyurea"/>
            </repeat>
            <br/>

            <obsgroup groupingConceptId="PIH:14872">
                <div class="two-columns">
                    <div>
                        <p class="list-inline">
                            <label>
                                <uimessage code="Complications since last visit"/>
                            </label>
                            <obs id="scd-comp-q" conceptId="PIH:14867" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                 answerCodes="yes,no,unknown">
                                <controls>
                                    <when value="PIH:YES" thenDisplay="#scd-comp-text"/>
                                </controls>
                            </obs>
                        </p>
                    </div>

                    <div id="scd-comp-text">
                        <label>
                            <uimessage code="Complication summary" />
                        </label>
                        <obs conceptId="PIH:14679" />
                    </div>
                </div>

                <div class="two-columns">
                    <div>
                        <p class="list-inline">
                            <label>
                                <uimessage code="Hydroxyurea indicated"/>
                            </label>
                            <obs id="scd-hydroxy-q" conceptId="PIH:14869" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO"
                                 answerCodes="yes,no">
                                <controls>
                                    <when value="PIH:YES" thenDisplay="#scd-hydroxy-details"/>
                                </controls>
                            </obs>
                        </p>
                    </div>

                    <div id="scd-hydroxy-details">
                        <p class="list-inline">
                            <label>
                                <uimessage code="Treatment with hydroxyurea" />
                            </label>
                            <obs conceptId="PIH:14870" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO" answerCodes="yes,no" />
                            <br/>

                            <label>
                                <uimessage code="Complications with hydroxyurea" />
                            </label>
                            <obs conceptId="PIH:14871" style="radio"
                                 answerConceptIds="PIH:YES,PIH:NO" answerCodes="yes,no" />
                        </p>
                    </div>
                </div>
            </obsgroup>

            <strong>
                <uimessage code="Sickle cell followup indicators"/>
            </strong>

            <!-- Sickle cell signs and symptoms -->
            <div>
                <repeat>
                    <template>
                        <p class="side-by-side">
                            <obsgroup groupingConceptId="PIH:14858" showIfEmpty="false">
                                <obs style="radio"
                                     conceptIds="PIH:SYMPTOM PRESENT,PIH:SYMPTOM ABSENT,PIH:SYMPTOM PRESENCE UNKNOWN"
                                     conceptLabels="yes,no,unknown" answerConceptId="{qId}" labelText="{symptName}"/>
                            </obsgroup>
                        </p>
                    </template>
                    <render qId="CIEL:114403" symptName="Pain"/>
                    <render qId="CIEL:140238" symptName="Fever"/>
                    <render qId="CIEL:136443" symptName="Jaundice"/>
                    <render qId="CIEL:121629" symptName="Anemia"/>
                    <render qId="CIEL:148346" symptName="Ascites"/>
                    <render qId="CIEL:112804" symptName="Spleen palpable"/>
                    <render qId="CIEL:168290" symptName="Liver palpable" />
                    <render qId="CIEL:142373" symptName="Difficulty breathing"/>
                    <render qId="CIEL:120749" symptName="Chest pain"/>
                </repeat>
            </div>

            <obsgroup groupingConceptId="PIH:14826">
                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown"/>
                                </p>
                            </template>
                            <render qId="CIEL:159610" questionName="Malaria prophylaxis" tog=""/>
                            <render qId="CIEL:167022" questionName="Family awareness of disease" tog=""/>
                        </repeat>
                    </div>
                    <div>
                        <obs conceptId="PIH:13748" labelCode="# of transfusions since last visit" />
                    </div>
                </div>

                <div class="two-columns">
                    <div>
                        <repeat>
                            <template>
                                <p class="list-inline">
                                    <label>
                                        <uimessage code="{questionName}"/>
                                    </label>
                                    <obs id="{tog}" conceptId="{qId}" style="radio"
                                         answerConceptIds="PIH:YES,PIH:NO,PIH:UNKNOWN"
                                         answerCodes="yes,no,unknown">
                                        <controls>
                                            <when value="PIH:YES" thenDisplay="#{tog}-details"/>
                                        </controls>
                                    </obs>
                                </p>
                            </template>
                            <render qId="CIEL:1898"   questionName="Patient condition improved" tog="scd-fui-improved"/>
                            <render qId="CIEL:164075" questionName="Overall treatment adherence" tog="scd-fui-adher"/>
                            <render qId="CIEL:167819" questionName="Missed doses in past week" tog="scd-fui-miss"/>
                            <render qId="CIEL:167021" questionName="Aware and understands the disease" tog="scd-fui-aware"/>
                            <render qId="CIEL:167914" questionName="Understands treatment" tog="scd-fui-under"/>
                            <render qId="PIH:14741"   questionName="Ability to titrate treatment" tog="scd-fui-tite"/>
                        </repeat>
                    </div>

                    <div id="scd-fui-miss-details">
                        <br/><br/>
                        <label>
                            <uimessage code="# of missed doses in past week"/>
                        </label>
                        <obs conceptId="CIEL:167918"/>
                    </div>

                </div>
           </obsgroup>

        </div>
    </section>

    <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="pihcore.other">
        <div id="other-ncd" class="section-container">
            <p>
                <repeat with="['CIEL:119624','Deep vein thrombosis'],
                              ['CIEL:113504','Pulmonary embolism'],
                              ['CIEL:148203','Atrial fibrillation'],
                              ['PIH:3181','Mechanical heart valve'],
                              ['CIEL:117441','Hyperlipidemia'],
                              ['CIEL:115115','Obesity']">

                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                        <obs conceptId="PIH:DIAGNOSIS" answerConceptId="{0}" style="checkbox"/>
                    </obsgroup>
                </repeat>

                <!-- Other diagnosis and comment -->
                <label>
                    <uimessage code="Other NCD diagnosis" />
                </label>
                <obs conceptId="PIH:7416"/>
            </p>
        </div>
    </section>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <button id="next" type="button" class="submitButton confirm right">
                <uimessage code="emr.next"/>
                <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
            </button>
            <button id="submit" class="submitButton confirm right">
                <uimessage code="mirebalais.save"/>
                <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
            </button>
            <button id="cancel" type="button" class="cancel">
                <uimessage code="emr.cancel"/>
            </button>
        </div>
    </ifMode>

</htmlform>
